var slideParticles=function(t,i,s){"use strict";function e(t,i,s){this.instance=t,this.type="string"!=typeof i?"picture":"text",this.picture=i,this.canvas=this.instance.getCanvas(s),this.context=this.instance.getContext2D(this.canvas),this.size="string"!=typeof i?this.instance.getImageSize(i,s):{x:0,y:0,w:0,h:0},this.pixels=this.getPixels(),this.matrix=this.buildAllMatrix()}function n(t){this.settings=Object.assign({},f,t),this.matrixTab=[],this.thumbOriginalTab=[],this.particles=[],this.champs=[],this.mode=this.settings.initialMode,this.liberation=!1,this.activeIndex=null,this.canvas=this.getCanvas(),this.context=this.getContext2D(this.canvas)}function a(t){return Math.cos(Math.random()*Math.PI)*t}function h(t,i){this.x=t||0,this.y=i||0}function r(t,i,s,e){this.instance=t,this.position=i||new h(0,0),this.vitesse=s||new h(0,0),this.acceleration=e||new h(0,0),this.color=this.instance.settings.particleColor,this.inForm=0}function o(t,i){this.position=t,this.setMass(i)}var c,l,u,p,m,f={height:150,width:300,background:"#fff",thresholdNB:[128],targetElement:"dp-canvas",inputFileID:"dp-fileinput",thumdnailsID:"dp-thumb",panelID:"dp-panel-settings",thumbWidth:100,thumbHeight:100,text:"Salut !",mass:100,antiMass:-500,density:1500,particleSize:1,particleColor:"#000",textColor:"#fff",font:"Arial",fontSize:40,initialVelocity:3,massX:880,massY:370,initialMode:"modeForm",draw:!1,stop:!1,switchModeCallback:null};return p={modeForm:{name:"blackAndWhite",param:"thresholdNB"}},u={modeForm:["soumisChamp","soumisForm"]},m={modeForm:"valueMatrix"},c={getViewport:function(){return{w:Math.max(i.documentElement.clientWidth,t.innerWidth||0),h:Math.max(i.documentElement.clientHeight,t.innerHeight||0)}},append:function(t,s){"string"==typeof t?i.getElementById(t).appendChild(s):t.appendChild(s)},simpleExtend:function(t,i){for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);return t}},e.prototype={clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},getPixels:function(){switch(this.clear(),this.type){case"picture":this.context.drawImage(this.picture,this.size.x,this.size.y,this.size.w,this.size.h);break;case"text":this.setText();break;default:return!1}return!(!this.size.w&&!this.size.h)&&this.context.getImageData(this.size.x,this.size.y,this.size.w,this.size.h)},setText:function(){var t=this.picture.trim();if(""===t)return this.size.x=0,this.size.y=0,this.size.w=0,this.size.h=0,this.clearMatrix(),!1;var i,s=0,e=20,n=80,a=this.picture.split("\n"),h=this.instance.settings.fontSize;for(this.context.font=h+"px "+this.instance.settings.font,this.context.fillStyle=this.instance.settings.textColor,this.context.textAlign="left",i=0;i<a.length;i++)this.context.fillText(a[i],e,n+i*h),s=Math.max(s,Math.floor(this.context.measureText(a[i]).width));this.size.x=Math.max(e,this.size.x),this.size.y=Math.max(n-h,this.size.y),this.size.w=Math.max(s+h,this.size.w),this.size.h=Math.max(h*i+h,this.size.h)},applyFilter:function(t,i){var s,e=this.getPixels();if(t){var n=[e];for(s=0;s<i.length;s++)n.push(i[s]);this.pixels=l[t].apply(null,n),this.context.putImageData(this.pixels,this.size.x,this.size.y)}else this.pixels=e},buildAllMatrix:function(){var t,i={};for(var s in m)t=this.creaMatrix(),this.applyFilter(p[s].name,this.instance.settings[p[s].param]),this[m[s]](t,1),i[s]=t;return i},getMatrix:function(){return this.matrix[this.instance.mode]},creaMatrix:function(){var t,i,s=this.instance.settings.width,e=this.instance.settings.height,n=new Array(s);for(t=0;t<s;t++)for(n[t]=new Array(e),i=0;i<e;i++)n[t][i]=0;return n},clearMatrix:function(t){var i,s,e,n,a,h=this.getMatrix();for(a=t||0,e=h.length,n=h[0].length,i=0;i<e;i++)for(s=0;s<n;s++)h[i][s]=a},valueMatrix:function(t,i){var s=this.size.x,e=Math.min(Math.floor(s+this.size.w),t.length),n=this.size.y,a=Math.min(Math.floor(n+this.size.h),t[0].length);if(!(t.length<s||t[0].length<a)){var h,r,o=this.context.getImageData(0,0,this.instance.canvas.width,this.instance.canvas.height).data;for(h=s;h<e;h++)for(r=n;r<a;r++){var c=o[4*(this.instance.canvas.width*r+h)];t[h][r]=255===c?i:0}}},renderThumbnails:function(t,i){var s=this,n=new e(this.instance,this.picture,{w:this.instance.settings.thumbWidth,h:this.instance.settings.thumbHeight});return i&&n.applyFilter(p[this.instance.mode].name,this.settings[p[this.instance.mode].param]),n.canvas.onclick=function(t){return function(i){s.instance.goTo(t),s.instance.clearParts(),s.instance.liberationParts1()}}(n),this.instance.thumbOriginalTab.push(n),c.append(t,n.canvas),n}},n.prototype={init:function(){c.append(this.settings.targetElement,this.canvas),this.canvas.style.backgroundColor=this.settings.background,this.centerMass(),this.champs.push(new o(new h(this.settings.massX,this.settings.massY),this.settings.mass)),this.loop()},set:function(t){Object.assign(this.settings,t)},createSlide:function(t,i){var s=new e(this,t,i);return this.activeIndex=null===this.activeIndex?0:this.activeIndex,this.matrixTab.push(s),s},getCanvas:function(t){var s=i.createElement("canvas"),e=t||{};return s.height=e.h?e.h:this.settings.height,s.width=e.w?e.w:this.settings.width,s},getContext2D:function(t){return t.getContext("2d")},getImageSize:function(t,i){var s=t.width,e=t.height,n=i?i.w:this.canvas.width,a=i?i.h:this.canvas.height,h=s/e;return s>=e&&s>n?(s=n,e=Math.round(s/h)):e>a&&(e=a,s=Math.round(e*h)),{x:Math.round((n-s)/2),y:Math.round((a-e)/2),w:s,h:e}},load:function(t){var i,s=t.target.files,e=this;if(s)for(i=0;i<s.length;i++){var n=s[i];if(n.type.match("image")){var a=new FileReader;a.onload=function(t){var i=new Image;i.onload=function(){var t;t=e.createSlide(this),t.renderThumbnails(e.settings.thumdnailsID,!1)},i.src=t.target.result},a.readAsDataURL(n)}}},switchMode:function(t){this.mode=t,"function"==typeof this.settings.switchModeCallback&&this.settings.switchModeCallback.call(this)},addMass:function(t,i,s){var e=new o(new h(t,i),s);return this.champs.push(e),e},centerMass:function(){this.settings.massX=this.canvas.width/2,this.settings.massY=this.canvas.height/2},partProceed:function(t){var i,s=u[this.mode].length;for(i=0;i<s;i++)t[u[this.mode][i]]()},goTo:function(t){this.activeIndex=this.thumbOriginalTab.indexOf(t)},liberationParts1:function(){var t=this;this.liberation=!this.liberation,this.champs[0].mass=this.settings.antiMass,setTimeout(function(){t.champs[0].mass=t.settings.mass,t.liberation=!t.liberation},500)},creaParts:function(){if(this.particles.length<this.settings.density){var t,i=this.settings.density-this.particles.length;for(t=0;t<i;t++)this.particles.push(new r(this,new h(Math.random()*this.canvas.width,Math.random()*this.canvas.height),new h(a(this.settings.initialVelocity),a(this.settings.initialVelocity)),new h(0,0),0,(!1)))}},upgradeParts:function(){var t,i=[],s=this.particles.length;for(t=0;t<s;t++){var e=this.particles[t],n=e.position;n.x>=this.canvas.width||n.x<=0||n.y>=this.canvas.height||n.y<=0||(this.partProceed(e),e.move(),i.push(e))}this.particles=i,this.settings.bigbang=!1},drawParts:function(){var t,i=this.particles.length;for(t=0;t<i;t++){var s=this.particles[t].position;this.context.fillStyle=this.particles[t].color,this.context.fillRect(s.x,s.y,this.settings.particleSize,this.settings.particleSize)}},clearParts:function(){var t,i=this.particles.length;for(t=0;t<i;t++)this.particles[t].inForm=0},clear:function(){this.settings.draw||this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},queue:function(){var i=this;this.settings.stop?(t.cancelAnimationFrame(i.requestID),this.requestID=s):this.requestID=t.requestAnimationFrame(i.loop.bind(i))},update:function(){this.creaParts(),this.upgradeParts()},draw:function(){this.drawParts()},loop:function(){this.clear(),this.update(),this.draw(),this.queue()},stop:function(){this.settings.stop=!0},start:function(){this.settings.stop=!1,this.loop()}},l={blackAndWhite:function(t,i){if(!t)return t;var s,e,n,a,h,r=t.data;for(s=0;s<r.length;s+=4)e=r[s],n=r[s+1],a=r[s+2],h=.2126*e+.7152*n+.0722*a>=i?255:0,r[s]=r[s+1]=r[s+2]=h;return t}},h.prototype.add=function(t){this.x+=t.x,this.y+=t.y},h.prototype.getInvert=function(){this.x=-1*this.x,this.y=-1*this.y},h.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},h.prototype.getAngle=function(){return Math.atan2(this.y,this.x)},h.prototype.fromAngle=function(t,i){return new h(i*Math.cos(t),i*Math.sin(t))},r.prototype.move=function(){this.vitesse.add(this.acceleration),this.position.add(this.vitesse)},r.prototype.soumisChamp=function(){if(this.instance.champs[0].mass&&1!==this.inForm){for(var t=0,i=0,s=this.instance.champs.length,e=0;e<s;e++){var n=this.instance.champs[e].position.x-this.position.x,a=this.instance.champs[e].position.y-this.position.y,r=this.instance.champs[e].mass/Math.pow(n*n+a*a,1.5);t+=n*r,i+=a*r}this.acceleration=new h(t,i)}},r.prototype.soumisForm=function(){if(this.instance.liberation)return void(this.inForm=0);var t=Math.floor(this.position.x),i=Math.floor(this.position.y),s=null!==this.instance.activeIndex?this.instance.matrixTab[this.instance.activeIndex].getMatrix()[t][i]:0;0!==s?1!==this.inForm&&(this.inForm=1,this.vitesse=new h(.2*this.vitesse.x,.2*this.vitesse.y),this.acceleration=new h(0,0)):1===this.inForm&&this.vitesse.getInvert()},o.prototype.setMass=function(t){this.mass=t||0,this.color=t<0?"#f00":"#0f0"},Array.prototype.indexOf||(Array.prototype.indexOf=function(t,i){var s;if(null==this)throw new TypeError('"this" vaut null ou n est pas dÃ©fini');var e=Object(this),n=e.length>>>0;if(0===n)return-1;var a=+i||0;if(Math.abs(a)===1/0&&(a=0),a>=n)return-1;for(s=Math.max(a>=0?a:n-Math.abs(a),0);s<n;){if(s in e&&e[s]===t)return s;s++}return-1}),"function"!=typeof Object.assign&&(Object.assign=function(t,i){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(t),e=1;e<arguments.length;e++){var n=arguments[e];if(null!=n)for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(s[a]=n[a])}return s}),function(){for(var i=0,s=["ms","moz","webkit","o"],e=0;e<s.length&&!t.requestAnimationFrame;++e)t.requestAnimationFrame=t[s[e]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[s[e]+"CancelAnimationFrame"]||t[s[e]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(s,e){var n=(new Date).getTime(),a=Math.max(0,16-(n-i)),h=t.setTimeout(function(){s(n+a)},a);return i=n+a,h}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}(),{getInstance:function(t){var i=new n(t);return i.init(),i},registerModule:function(t,i){c.simpleExtend(n.prototype,i.proto),f[t]=i.options},registerMode:function(t,i){c.simpleExtend(f,i.options),c.simpleExtend(r.prototype,i.proto_particles),c.simpleExtend(e.prototype,i.proto_matrix),p[t]=i.scenario.filters,u[t]=i.scenario.proceed,m[t]=i.scenario.matrixMethod}}}(this,this.document);slideParticles.registerMode("modeColor",{options:{},proto_particles:{soumisColor:function(){this.inForm=0;var t=Math.floor(this.position.x),i=Math.floor(this.position.y);this.color=null!==this.instance.activeIndex?this.instance.matrixTab[this.instance.activeIndex].getMatrix()[t][i]:this.instance.settings.particleColor}},proto_matrix:{colorMatrix:function(t){var i=this.size.x,s=this.size.y,e=Math.floor(s+this.size.h);if(!(t.length<i||t[0].length<e)){var n,a,h,r,o,c=this.context.getImageData(0,0,this.instance.canvas.width,this.instance.canvas.height).data;for(n=0;n<this.canvas.height;n++)for(a=0;a<this.canvas.width;a++)h=c[4*(this.instance.canvas.width*a+n)],r=c[4*(this.instance.canvas.width*a+n)+1],o=c[4*(this.instance.canvas.width*a+n)+2],t[n][a]="rgba("+h+", "+r+", "+o+", 1)"}}},filter:{},scenario:{filters:{name:null,param:null},proceed:["soumisChamp","soumisColor"],matrixMethod:"colorMatrix"}});